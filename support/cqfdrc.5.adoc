= cqfdrc(5)
:doctype: manpage
:author: Gaël PORTAY
:email: gael.portay@gmail.com
:lang: en
:man manual: cqfdrc
:man source: dosh 7

== NAME

cqfdrc - the cqfd configuration file

== DESCRIPTION

The _.cqfdrc_ file at the root of your project contains the information
required to support project tooling. It is written in an .ini-like format.

Here is a sample _.cqfdrc_ file:

	[project]
	org='fooinc'
	name='buildroot'

	[build]
	command='make foobar_defconfig && make && asciidoc README.FOOINC'
	files='README.FOOINC output/images/sdcard.img'
	archive='cqfd-%Gh.tar.xz'

**Comment**

The _.cqfdrc_ file supports Unix shell comments; the words after the character
_#_ are ignored up to the end of line. A comment cannot be set in the first
line, and right after a section.

**The [project] section**

_org_::
	a short, lowercase name for the project’s parent organization.

_name_::
	a short, lowercase name for the project.

_build_context (optional)_::
	a directory to pass as the build context to Docker. This should be
	specified relatively to where _cqfd_ is invoked.  For example, it can
	be set to _._, to use the current working directory of the invoked
	_cqfd_ command as the Docker build context, which can be useful when
	files at the root of the project are required to build the image. When
	using this option, a _.dockerignore_ file can be useful to limit what
	gets sent to the Docker daemon.

_custom_img_name (optional)_::
	allows specifying a custom Docker image name instead of the one
	automatically generated by cqfd. You can also include a private
	repository URL in the image name. If you do, cqfd will try to pull the
	image from the provided repository, if not already available on your
	system.

**Docker image naming**

Unless _custom_img_name_ is used, Docker images generated by cqfd will be named
_cqfd_$username_$org_$name_$hash_, using the following variables:

_$username_::
	The UNIX username used to launch cqfd.

_$org_::
	The _org_ variable in the _[project]_ section of your _.cqfdrc_.

_$name_::
	The _name_ variable in the _[project]_ section of your _.cqfdrc_.

_$hash_::
	A hash of the local _Dockerfile_.

**The [build] section**

cqfd run:

_command_::
	The command string to be executed when cqfd is invoked. This string
	will be passed as an argument to a classical _sh -c "commands"_, within
	the build container, to generate the build artefacts.

_distro (optional)_::
	The name of the directory containing the Dockerfile. By default, cqfd
	uses _"docker"_, and _.cqfd/docker/Dockerfile_ is used.

_user_extra_groups (optional)_::
	A space-separated list of groups the user should be a member of in the
	container. You can either use the _group:gid_ format, or simply specify
	the _group_ name if it exists either in the host or inside the docker
	image.

_flavors (optional)_::
	The list of build flavors (see below). Each flavor has its own command
	just like _build.command_. This property is now automatically deduced
	from the flavors sections of _.cqfdrc_.

_docker_build_args (optional)_::
	Arguments used to invoke _docker build_.

_docker_run_args (optional)_::
	Arguments used to invoke _docker run_.

cqfd release:

_files_::
	The space-separated list of files generated by the build process that
	we want to include inside a standard release archive.

_archive (optional)_::
	The name of the release archive generated by cqfd. You can include
	environment variable names, as well as the following template marks:

* _%Gh_ - git short hash of last commit
* _%GH_ - git long hash of last commit
* _%D3_ - RFC3339 date (YYYY-MM-DD)
* _%Du_ - Unix timestamp
* _%Cf_ - current cqfd flavor name (if any)
* _%Po_ - value of the _project.org_ configuration key
* _%Pn_ - value of the _project.name_ configuration key
* _%%_ - a litteral _%_ sign

By default, cqfd will generate a release archive named _org-name.tar.xz_, where
_org_ and _name_ come from the project's configuration keys. The .tar.xz,
.tar.gz and .zip archive formats are supported.

For tar archives:

* Setting _tar_transform=yes_ (optional) will cause all files specified for
  the archive to be stored at the root of the archive, which is desired in some
  scenarios.

* Setting _tar_options_ (optional) will pass extra options to the tar
  command. For example, setting _tar_options=-h_ will copy all symlink files as
  hardlinks, which is desired in some scenarios.

**Using build flavors**

In some cases, it may be desirable to build the project using variations of the
build and release methods (for example a debug build). This is made possible in
cqfd with the build flavors feature.

In the _.cqfdrc_ file, one or more flavors may be listed in the _[build]_
section, referencing other sections named following flavor's name.

	[centos7]
	command='make CENTOS=1'
	distro='centos7'

	[debug]
	command='make DEBUG=1'
	files='myprogram Symbols.map'

	[build]
	command='make'
	files='myprogram'

A flavor will typically redefine some keys of the build section: command,
files, archive, distro.

== PATCHES

Submit patches at *https://github.com/gportay/dosh/pulls*

== BUGS

Report bugs at *https://github.com/gportay/dosh/issues*

== AUTHOR

Written by Gaël PORTAY *gael.portay@gmail.com*

== COPYRIGHT

Copyright 2024-2025 Gaël PORTAY

This program is free software: you can redistribute it and/or modify it under
the terms of the GNU Lesser General Public License as published by the Free
Software Foundation, either version 2.1 of the License, or (at your option) any
later version.

== TRIVIA

CQFD stands for "ce qu'il fallait Dockeriser", French for "what needed to be
Dockerized".

== SEE ALSO

docker-build(1), docker-run(1), cqfd(1)
